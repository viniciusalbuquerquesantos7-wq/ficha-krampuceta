<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha Krampuceta - Sistema RPG Ordem Paranormal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a0a0a 0%, #2d0a0a 100%);
            padding: 0;
            margin: 0;
            color: #e8dcc4;
        }

        .toolbar {
            max-width: 900px;
            margin: 10px auto 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border: 2px solid #8B0000;
            border-radius: 5px;
        }

        .toolbar button {
            padding: 10px;
            background: linear-gradient(135deg, #8B0000 0%, #5a0000 100%);
            color: #D4AF37;
            border: 2px solid #D4AF37;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toolbar button:hover {
            background: linear-gradient(135deg, #5a0000 0%, #8B0000 100%);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .toolbar button:active {
            transform: scale(0.98);
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            background: linear-gradient(135deg, #3d1f1f 0%, #2a1515 100%);
            border: 2px solid #8B0000;
            padding: 10px;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.5), inset 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: visible;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            box-sizing: border-box;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139, 0, 0, 0.03) 2px, rgba(139, 0, 0, 0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(139, 0, 0, 0.03) 2px, rgba(139, 0, 0, 0.03) 4px);
            pointer-events: none;
        }

        .content {
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 12px;
            border-bottom: 2px solid #8B0000;
            border-top: 2px solid #8B0000;
            padding: 8px 0;
            position: relative;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .header::before,
        .header::after {
            content: '✝';
            position: absolute;
            font-size: 24px;
            color: #D4AF37;
            top: 50%;
            transform: translateY(-50%);
        }

        .header::before {
            left: 10px;
        }

        .header::after {
            right: 10px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 2px;
            letter-spacing: 1px;
            color: #D4AF37;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .header p {
            font-size: 10px;
            color: #999;
            letter-spacing: 0.5px;
        }

        .section {
            margin-bottom: 12px;
            position: relative;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .section-title {
            background: linear-gradient(90deg, #8B0000 0%, #5a0000 50%, #8B0000 100%);
            color: #D4AF37;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-left: 4px solid #D4AF37;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 8px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .section-title::before {
            content: '⬥';
            font-size: 10px;
            color: #D4AF37;
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 8px;
        }

        .info-field {
            display: flex;
            flex-direction: column;
        }

        .info-field label {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #D4AF37;
        }

        .info-field input[type="text"],
        .info-field input[type="number"],
        .info-field textarea {
            border: 2px solid #8B0000;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #e8dcc4;
            transition: all 0.3s ease;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .info-field input[type="text"]:focus,
        .info-field input[type="number"]:focus,
        .info-field textarea:focus {
            outline: none;
            border-color: #D4AF37;
            background-color: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .info-field textarea {
            resize: vertical;
            min-height: 50px;
        }

        .attributes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .attribute-box {
            border: 3px solid #8B0000;
            padding: 12px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(139, 0, 0, 0.1) 100%);
            position: relative;
            transition: all 0.3s ease;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .attribute-box:hover {
            border-color: #D4AF37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .attribute-box::before {
            content: '◆';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            color: #D4AF37;
            font-size: 14px;
            background: #3d1f1f;
            padding: 0 6px;
        }

        .attribute-label {
            font-weight: bold;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #D4AF37;
        }

        .attribute-value {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .attribute-value input[type="number"] {
            width: 45px;
            text-align: center;
            border: 2px solid #8B0000;
            padding: 6px;
            font-weight: bold;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #D4AF37;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .attribute-value input[type="number"]:focus {
            outline: none;
            border-color: #D4AF37;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .attribute-value input[type="number"]:disabled {
            background-color: rgba(139, 0, 0, 0.3) !important;
            color: #999 !important;
            border-color: #666 !important;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .attribute-modifier {
            font-size: 9px;
            color: #999;
        }

        .attribute-modifier input {
            width: 45px;
            border: 1px solid #8B0000;
            padding: 4px;
            text-align: center;
            font-size: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #e8dcc4;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .items-section {
            margin-bottom: 15px;
        }

        .items-list {
            border: 2px solid #8B0000;
            padding: 12px;
            background-color: rgba(0, 0, 0, 0.3);
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .item-row {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .item-row:last-child {
            margin-bottom: 0;
        }

        .item-row input[type="text"] {
            border: 1px solid #8B0000;
            padding: 6px;
            font-size: 11px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #e8dcc4;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .item-row input[type="text"]:focus {
            outline: none;
            border-color: #D4AF37;
        }

        .item-row input[type="number"] {
            border: 1px solid #8B0000;
            padding: 6px;
            font-size: 11px;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.3);
            color: #e8dcc4;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .item-row input[type="number"]:focus {
            outline: none;
            border-color: #D4AF37;
        }

        .item-row input[type="checkbox"] {
            margin-right: 8px;
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #8B0000;
            background-color: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .item-row input[type="checkbox"]:checked {
            background-color: #8B0000;
            border-color: #D4AF37;
        }

        .item-row input[type="checkbox"]:checked::after {
            content: '✓';
            color: #D4AF37;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .item-row label {
            display: flex;
            align-items: center;
            font-size: 11px;
            color: #e8dcc4;
        }

        .item-row label input[type="text"] {
            flex-grow: 1;
            margin-left: 8px;
        }

        .notes-section textarea {
            width: 100%;
            min-height: 150px;
            border: 2px solid #8B0000;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #e8dcc4;
            resize: vertical;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .notes-section textarea:focus {
            outline: none;
            border-color: #D4AF37;
            background-color: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        /* Print Styles */
        @media print {
            body {
                background: none;
                color: #000;
            }

            .toolbar {
                display: none !important;
            }

            .container {
                max-width: 100%;
                margin: 0;
                border: none;
                box-shadow: none;
                background: none;
                padding: 0;
            }

            .header, .section-title {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                color: #000 !important;
                background: #eee !important;
                border-color: #000 !important;
            }

            .header h1 {
                color: #000 !important;
                text-shadow: none;
            }

            .header::before, .header::after {
                color: #000 !important;
            }

            .info-field input[type="text"],
            .info-field input[type="number"],
            .info-field textarea,
            .attribute-value input[type="number"],
            .attribute-modifier input,
            .items-list,
            .item-row input[type="text"],
            .item-row input[type="number"],
            .notes-section textarea {
                border-color: #000 !important;
                background-color: #fff !important;
                color: #000 !important;
                box-shadow: none !important;
            }

            .attribute-box {
                border-color: #000 !important;
                background: #fff !important;
                box-shadow: none !important;
            }

            .attribute-label {
                color: #000 !important;
            }

            .attribute-box::before {
                color: #000 !important;
                background: #fff !important;
            }

            .item-row input[type="checkbox"] {
                border-color: #000 !important;
            }

            .item-row input[type="checkbox"]:checked {
                background-color: #000 !important;
                border-color: #000 !important;
            }

            .item-row input[type="checkbox"]:checked::after {
                content: '✓';
                color: #fff !important;
            }
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button id="save-btn">Salvar Localmente</button>
        <button id="load-btn">Carregar Localmente</button>
        <button id="clear-btn">Limpar Ficha</button>
        <button id="pdf-btn">Exportar PDF</button>
        <button id="print-btn">Imprimir Ficha</button>
    </div>

    <div class="container" id="character-sheet">
        <div class="corner-symbol top-left">✝</div>
        <div class="corner-symbol top-right">✝</div>
        <div class="corner-symbol bottom-left">✝</div>
        <div class="corner-symbol bottom-right">✝</div>

        <div class="content">
            <div class="header">
                <div id="point-buy-display" style="font-size: 14px; font-weight: bold; color: #D4AF37; margin-bottom: 5px;">Pontos Restantes: 20</div>
                <h1>FICHA KRAMPUCETA</h1>
                <p>Sistema RPG - Ordem Paranormal</p>
            </div>

            <!-- Informações Básicas -->
            <div class="section">
                <div class="section-title">Informações Básicas</div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="nome">Nome do Personagem</label>
                        <input type="text" id="nome">
                    </div>
                    <div class="info-field">
                        <label for="jogador">Nome do Jogador</label>
                        <input type="text" id="jogador">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="classe">Classe</label>
                        <input type="text" id="classe">
                    </div>
                    <div class="info-field">
                        <label for="origem">Origem</label>
                        <input type="text" id="origem">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="patente">Patente</label>
                        <input type="text" id="patente">
                    </div>
                    <div class="info-field">
                        <label for="nex">NEX</label>
                        <input type="text" id="nex">
                    </div>
                </div>
            </div>

            <div class="decorative-line"></div>

            <!-- Pontos de Status -->
            <div class="section">
                <div class="section-title">Pontos de Status</div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="pontosSanidade">Pontos de Sanidade (PS)</label>
                        <input type="number" id="pontosSanidade" value="10" min="0" max="100">
                    </div>
                    <div class="info-field">
                        <label for="pontosEsforco">Pontos de Esforço (PE)</label>
                        <input type="number" id="pontosEsforco" value="10" min="0" max="100">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="pontosVida">Pontos de Vida (PV)</label>
                        <input type="number" id="pontosVida" value="10" min="0" max="100">
                    </div>
                </div>
            </div>

            <div class="decorative-line"></div>

            <!-- Atributos -->
            <div class="section">
                <div class="section-title">Atributos</div>
                <div class="attributes-grid">
                    <div class="attribute-box">
                        <div class="attribute-label">Força</div>
                        <div class="attribute-value">
                            <input type="number" id="forca" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="forcaMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Agilidade</div>
                        <div class="attribute-value">
                            <input type="number" id="agilidade" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="agilidadeMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Crença</div>
                        <div class="attribute-value">
                            <input type="number" id="crenca" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="crencaMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Conhecimento</div>
                        <div class="attribute-value">
                            <input type="number" id="conhecimento" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="conhecimentoMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Inteligência</div>
                        <div class="attribute-value">
                            <input type="number" id="inteligencia" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="inteligenciaMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Percepção</div>
                        <div class="attribute-value">
                            <input type="number" id="percepcao" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="percepcaoMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Constituição</div>
                        <div class="attribute-value">
                            <input type="number" id="constituicao" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="constituicaoMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Resist. Sobrenatural</div>
                        <div class="attribute-value">
                            <input type="number" id="resistenciaSobrenatural" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="resistenciaSobrenaturalMod" placeholder="Mod">
                        </div>
                    </div>

                    <div class="attribute-box">
                        <div class="attribute-label">Carisma</div>
                        <div class="attribute-value">
                            <input type="number" id="carisma" class="atributo" value="0" min="0" onchange="atualizarPontos()" oninput="atualizarPontos()">
                        </div>
                        <div class="attribute-modifier">
                            <input type="text" id="carismaMod" placeholder="Mod">
                        </div>
                    </div>
                </div>
            </div>

            <div class="decorative-line"></div>

            <!-- Perícias -->
            <div class="section">
                <div class="section-title">Perícias</div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="acrobacia">Acrobacia</label>
                        <input type="text" id="acrobacia">
                    </div>
                    <div class="info-field">
                        <label for="adestramento">Adestramento</label>
                        <input type="text" id="adestramento">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="artes">Artes</label>
                        <input type="text" id="artes">
                    </div>
                    <div class="info-field">
                        <label for="atletismo">Atletismo</label>
                        <input type="text" id="atletismo">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="atualidades">Atualidades</label>
                        <input type="text" id="atualidades">
                    </div>
                    <div class="info-field">
                        <label for="ciencia">Ciência</label>
                        <input type="text" id="ciencia">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="crime">Crime</label>
                        <input type="text" id="crime">
                    </div>
                    <div class="info-field">
                        <label for="diplomacia">Diplomacia</label>
                        <input type="text" id="diplomacia">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="enganacao">Enganação</label>
                        <input type="text" id="enganacao">
                    </div>
                    <div class="info-field">
                        <label for="fortitude">Fortitude</label>
                        <input type="text" id="fortitude">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="furtividade">Furtividade</label>
                        <input type="text" id="furtividade">
                    </div>
                    <div class="info-field">
                        <label for="iniciativa">Iniciativa</label>
                        <input type="text" id="iniciativa">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="intimidacao">Intimidação</label>
                        <input type="text" id="intimidacao">
                    </div>
                    <div class="info-field">
                        <label for="intuicao">Intuição</label>
                        <input type="text" id="intuicao">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="investigacao">Investigação</label>
                        <input type="text" id="investigacao">
                    </div>
                    <div class="info-field">
                        <label for="luta">Luta</label>
                        <input type="text" id="luta">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="medicina">Medicina</label>
                        <input type="text" id="medicina">
                    </div>
                    <div class="info-field">
                        <label for="ocultismo">Ocultismo</label>
                        <input type="text" id="ocultismo">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="percepcaoPericia">Percepção</label>
                        <input type="text" id="percepcaoPericia">
                    </div>
                    <div class="info-field">
                        <label for="pilotagem">Pilotagem</label>
                        <input type="text" id="pilotagem">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="pontaria">Pontaria</label>
                        <input type="text" id="pontaria">
                    </div>
                    <div class="info-field">
                        <label for="profissao">Profissão</label>
                        <input type="text" id="profissao">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="reflexos">Reflexos</label>
                        <input type="text" id="reflexos">
                    </div>
                    <div class="info-field">
                        <label for="religiao">Religião</label>
                        <input type="text" id="religiao">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="sobrevivencia">Sobrevivência</label>
                        <input type="text" id="sobrevivencia">
                    </div>
                    <div class="info-field">
                        <label for="sorte">Sorte</label>
                        <input type="text" id="sorte">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="taticas">Táticas</label>
                        <input type="text" id="taticas">
                    </div>
                    <div class="info-field">
                        <label for="tecnologia">Tecnologia</label>
                        <input type="text" id="tecnologia">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label for="vontade">Vontade</label>
                        <input type="text" id="vontade">
                    </div>
                </div>
            </div>

            <div class="decorative-line"></div>

            <!-- Itens e Equipamentos -->
            <div class="section items-section">
                <div class="section-title">Itens e Equipamentos</div>
                <div class="items-list">
                    <div class="item-row">
                        <label><input type="checkbox" id="item1Check"><input type="text" id="item1Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item1Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item2Check"><input type="text" id="item2Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item2Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item3Check"><input type="text" id="item3Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item3Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item4Check"><input type="text" id="item4Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item4Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item5Check"><input type="text" id="item5Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item5Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item6Check"><input type="text" id="item6Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item6Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item7Check"><input type="text" id="item7Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item7Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item8Check"><input type="text" id="item8Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item8Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item9Check"><input type="text" id="item9Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item9Qtd" placeholder="Qtd">
                    </div>
                    <div class="item-row">
                        <label><input type="checkbox" id="item10Check"><input type="text" id="item10Nome" placeholder="Nome do Item"></label>
                        <input type="number" id="item10Qtd" placeholder="Qtd">
                    </div>
                </div>
            </div>

            <div class="decorative-line"></div>

            <!-- Habilidades e Poderes -->
            <div class="section notes-section">
                <div class="section-title">Habilidades e Poderes</div>
                <textarea id="habilidades"></textarea>
            </div>

            <div class="decorative-line"></div>

            <!-- Rituais e Magias -->
            <div class="section notes-section">
                <div class="section-title">Rituais e Magias</div>
                <textarea id="rituais"></textarea>
            </div>

            <div class="decorative-line"></div>

            <!-- Anotações -->
            <div class="section notes-section">
                <div class="section-title">Anotações</div>
                <textarea id="anotacoes"></textarea>
            </div>
        </div>
    </div>

    <script>
        const MAX_POINTS = 20;
        const attributeIds = ['forca', 'agilidade', 'crenca', 'conhecimento', 'inteligencia', 'percepcao', 'constituicao', 'resistenciaSobrenatural', 'carisma'];

        function calculatePointsSpent() {
            let totalSpent = 0;
            attributeIds.forEach(id => {
                const input = document.getElementById(id);
                // Usar parseInt para garantir que o valor é um número
                totalSpent += parseInt(input.value) || 0;
            });
            return totalSpent;
        }

        function updatePointBuy() {
            const totalSpent = calculatePointsSpent();
            const remainingPoints = MAX_POINTS - totalSpent;
            const display = document.getElementById('point-buy-display');
            display.textContent = `Pontos Restantes: ${remainingPoints}`;

            // Se os pontos restantes forem 0 ou menos, desabilita o aumento
            attributeIds.forEach(id => {
                const input = document.getElementById(id);
                
                // Se o total gasto for maior ou igual ao máximo, e o atributo não for 0,
                // desabilita o input para impedir o aumento (o min="0" já impede a diminuição abaixo de 0)
                if (totalSpent >= MAX_POINTS && parseInt(input.value) > 0) {
                    // Não desabilitamos, apenas controlamos o valor no input
                }
            });
        }

        // Função para controlar o input e garantir que o limite não seja excedido
        function handleAttributeInput(event) {
            const input = event.target;
            let newValue = parseInt(input.value) || 0;
            const oldValue = parseInt(input.getAttribute('data-old-value')) || 0;
            
            // 1. Garante que o valor não seja negativo
            if (newValue < 0) {
                newValue = 0;
                input.value = 0;
            }

            // 2. Calcula o total gasto *sem* a contribuição do valor antigo deste atributo
            let totalSpentWithoutCurrent = calculatePointsSpent() - oldValue;
            
            // 3. Verifica se o novo valor excede o limite
            if (totalSpentWithoutCurrent + newValue > MAX_POINTS) {
                // Calcula o valor máximo que este atributo pode ter
                const maxAllowed = MAX_POINTS - totalSpentWithoutCurrent;
                
                // Ajusta o valor do input para o máximo permitido
                input.value = maxAllowed;
                newValue = maxAllowed; // Atualiza newValue para o valor ajustado
            }
            
            // 4. Atualiza o valor antigo para o próximo evento
            input.setAttribute('data-old-value', newValue);
            
            updatePointBuy();
            saveCharacterSheet(); // Salva após a atualização
        }

        // Modifica a função loadCharacterSheet para inicializar o Point Buy
        function loadCharacterSheet() {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    if (input.type === 'checkbox') {
                        input.checked = savedValue === 'true';
                    } else {
                        input.value = savedValue;
                    }
                }
                // Inicializa o valor antigo para o controle de Point Buy
                if (attributeIds.includes(input.id)) {
                    input.setAttribute('data-old-value', input.value);
                }
            });
            updatePointBuy(); // Inicializa o display de pontos
            console.log('Ficha carregada localmente.');
        }

        // Adicionar listeners de evento
        document.addEventListener('DOMContentLoaded', () => {
            loadCharacterSheet();

            // Adicionar listener para salvar automaticamente ao digitar
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', saveCharacterSheet);
            });

            // Adicionar listeners para os atributos para controle de Point Buy
            attributeIds.forEach(id => {
                const input = document.getElementById(id);
                // Usa 'change' para garantir que o valor final é verificado
                input.addEventListener('change', handleAttributeInput);
                // Usa 'input' para capturar mudanças ao digitar
                input.addEventListener('input', handleAttributeInput);
            });

            // Adicionar listeners para os botões da toolbar
            document.getElementById('save-btn').addEventListener('click', saveCharacterSheet);
            document.getElementById('load-btn').addEventListener('click', loadCharacterSheet);
            document.getElementById('clear-btn').addEventListener('click', clearCharacterSheet);
            document.getElementById('pdf-btn').addEventListener('click', exportToPDF);
            document.getElementById('print-btn').addEventListener('click', () => window.print());
        });

        // O restante do seu script original...
        // Função para salvar dados no localStorage
        function saveCharacterSheet() {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    localStorage.setItem(input.id, input.checked);
                } else {
                    localStorage.setItem(input.id, input.value);
                }
            });
            console.log('Ficha salva localmente.');
        }

        // Função para limpar dados do localStorage
        function clearCharacterSheet() {
            if (confirm('Tem certeza que deseja limpar todos os dados da ficha? Esta ação é irreversível.')) {
                const inputs = document.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    localStorage.removeItem(input.id);
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
                updatePointBuy(); // Atualiza o display de pontos após limpar
                console.log('Ficha limpa.');
            }
        }

        // Função para exportar para PDF
        function exportToPDF() {
            const element = document.getElementById('character-sheet');
            const opt = {
                margin: 0.5,
                filename: 'ficha_krampuceta.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Ocultar a barra de ferramentas antes de gerar o PDF
            const toolbar = document.querySelector('.toolbar');
            toolbar.style.display = 'none';

            html2pdf().set(opt).from(element).save().then(() => {
                // Mostrar a barra de ferramentas novamente após a geração
                toolbar.style.display = 'grid';
            });
        }
    </script>
</body>
</html>
